Sub StockAnalysis():

    ' Setting intial variables
    Dim i As Long
    Dim j As Integer
    Dim k As Integer
    Dim firstOpen As Double
    Dim lastClose As Double
    Dim yearlyChange As Double
    Dim percentChange As Double
    Dim percChgConv As String
    Dim totalVolume As Double
    Dim wsCount As Integer
        
    j = 1
    totalVolume = 0
    
    wsCount = ActiveWorkbook.Worksheets.Count
    
    ' Gather data for summary table
    For i = 2 To 36112
        
       ' Record initial opening price on new worksheets
       If i = 2 Then
            firstOpen = Cells(i, 3).Value
       End If
                    
       ' Next row check for total volume calculation
       If Cells(i + 1, 1).Value = Cells(i, 1).Value Then
            totalVolume = totalVolume + Cells(i, 7).Value
       Else
            totalVolume = totalVolume + Cells(i, 7).Value
            lastClose = Cells(i, 6).Value
            
            ' Change calculations
            yearlyChange = lastClose - firstOpen
            percentChange = (yearlyChange / firstOpen)
            percChgConv = FormatPercent(percentChange)
            
            ' Add summary table header when working with multiple worksheets
            If j = 1 Then
                Cells(j, 9).Value = "Ticker"
                Cells(j, 10).Value = "Yearly Change"
                Cells(j, 11).Value = "Percent Change"
                Cells(j, 12).Value = "Total Stock Volume"
                Cells(j, 15).Value = "Ticker"
                Cells(j, 16).Value = "Value"
                Range("N2").Value = "Greatest % Increase"
                Range("N3").Value = "Greatest % Decrease"
                Range("N4").Value = "Greatest Total Volume"
            End If
            
            ' Post data to summary table
            j = j + 1
            Cells(j, 9).Value = Cells(i, 1).Value ' ticker
            Cells(j, 10).Value = yearlyChange
            Cells(j, 11).Value = percChgConv
            Cells(j, 12).Value = totalVolume
            
            ' Conditional formatting cell colors
            If (yearlyChange < 0) Then
                Cells(j, 10).Interior.ColorIndex = 3 ' Color cell red
            Else
                Cells(j, 10).Interior.ColorIndex = 4 ' Color cell green
            End If
            
            ' "Greatest" summary table update
            Range("P2").NumberFormat = "0.00%"
            Range("P3").NumberFormat = "0.00%"
            
            If (percentChange > Range("P2").Value) Then
                Range("O2").Value = Cells(i, 1).Value
                Range("P2").Value = percentChange
            ElseIf (percentChange < Range("P3").Value) Then
                    Range("O3").Value = Cells(i, 1).Value
                    Range("P3").Value = percentChange
            End If
                        
            If (totalVolume > Range("P4").Value) Then
                Range("O4").Value = Cells(i, 1).Value
                Range("P4").Value = totalVolume
            End If
            
            ' Value resets
            firstOpen = Cells(i + 1, 3).Value
            totalVolume = 0
       End If
    
    Next i

End Sub
